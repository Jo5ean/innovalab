---
import Layout from "@/layouts/Layout.astro";
import Slide1 from "./components/Slide1.astro";
import Slide2 from "./components/Slide2.astro";
import Slide3 from "./components/Slide3.astro";
import Slide4 from "./components/Slide4.astro";
import Slide5 from "./components/Slide5.astro";
import Slide6 from "./components/Slide6.astro"; 
import Slide8 from "./components/Slide8.astro";
import Slide9 from "./components/Slide9.astro";
import Slide10 from "./components/Slide10.astro";   
import Slide11 from "./components/Slide11.astro";
import Slide12 from "./components/Slide12.astro";
import SlideResults from "./components/SlideResults.astro";
import FrequentQuestionSlide from "./components/FrequentQuestionSlide.astro";
---

<Layout>
    <div class="swiper-container main-swiper">
        <div class="swiper-wrapper">
            <!-- Slide 1: Video Introductorio -->
            <div class="swiper-slide" data-slide-name="video">
                <Slide1 />
            </div>
            
            <!-- Slide 2: Botones con consulta de DNI -->
            <div class="swiper-slide" data-slide-name="buttons">
                <Slide2 />
            </div>
            
            <!-- Slide 3: Información -->
            <div class="swiper-slide" data-slide-name="info">
                <Slide3 />
            </div>

            <!-- Slide 4: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide4 />
            </div>

            <!-- Slide 5: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide5 />
            </div>

            <!-- Slide 6: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide6 />
            </div>
            
            <!-- Slide 7: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide8 />
            </div>

            <!-- Slide 8: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide9 />
            </div>

            <!-- Slide 9: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide10 />
            </div>

            <!-- Slide 10: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide11 />
            </div>

            <!-- Slide 11: Menú -->
            <div class="swiper-slide" data-slide-name="menu">
                <Slide12 />
            </div>

            <!-- Slide 12: Preguntas Frecuentes -->
            <div class="swiper-slide" data-slide-name="faq">
                <FrequentQuestionSlide />
            </div>
        </div>
        
        <!-- Paginación -->
        <div class="swiper-pagination"></div>
        
        <!-- Botones de navegación -->
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>
    
    <!-- Slide de resultados (fuera del carousel) -->
    <SlideResults />
</Layout>

<script>
    // Inicializar Swiper cuando se cargue el DOM
    document.addEventListener('DOMContentLoaded', function() {
        // @ts-ignore - Importamos Swiper desde la ventana global
        const swiper = new window.Swiper('.main-swiper', {
            direction: 'horizontal',
            loop: false,
            slidesPerView: 1,
            spaceBetween: 0,
            speed: 800,
            allowTouchMove: true, // Permitir navegación táctil
            mousewheel: false, // Deshabilitar navegación con rueda del mouse para permitir scroll natural
            simulateTouch: false, // Deshabilitar el comportamiento de arrastrar para evitar conflictos con scroll
            
            // Efecto de transición
            effect: 'fade',
            fadeEffect: {
                crossFade: true
            },
            
            // Paginación
            pagination: {
                el: '.swiper-pagination',
                clickable: true
            },
            
            // Botones de navegación
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev'
            },
            
            // Eventos
            on: {
                init: function() {
                    console.log('Swiper inicializado');
                    
                    // Ocultar botones de navegación en la primera slide
                    updateNavigationVisibility(0);
                },
                slideChange: function(this: any) {
                    // Actualizar visibilidad de los botones según la slide actual
                    updateNavigationVisibility(this.activeIndex);
                }
            }
        });

        // Función para controlar la visibilidad de los botones de navegación
        function updateNavigationVisibility(slideIndex: number) {
            const prevButton = document.querySelector('.swiper-button-prev');
            const nextButton = document.querySelector('.swiper-button-next');
            
            if (slideIndex === 0) {
                // Ocultar botones en la primera slide
                if (prevButton) prevButton.classList.add('hidden-nav');
                if (nextButton) nextButton.classList.add('hidden-nav');
            } else {
                // Mostrar botones en las demás slides
                if (prevButton) prevButton.classList.remove('hidden-nav');
                if (nextButton) nextButton.classList.remove('hidden-nav');
            }
        }

        // Exponer Swiper globalmente para que otros componentes puedan acceder a él
        // @ts-ignore
        window.swiperInstance = swiper;
        
        // Manejador para el botón "COMENZAR" en VideoSlide
        const startButton = document.querySelector('.start-button');
        if (startButton) {
            startButton.addEventListener('click', () => {
                swiper.slideTo(1);
                
                // Pequeña pausa para permitir que la animación se complete antes de habilitar el scroll
                setTimeout(() => {
                    document.body.style.overflow = 'auto';
                }, 600);
            });
        }
        
        // Controlar el scroll basado en la slide actual
        swiper.on('slideChange', function(this: any) {
            if (this.activeIndex === 0) {
                // En la primera slide (video), bloquear el scroll
                document.body.style.overflow = 'hidden';
            } else {
                // En las demás slides, permitir scroll
                document.body.style.overflow = 'auto';
            }
        });
        
        // Configuración inicial
        if (swiper.activeIndex === 0) {
            document.body.style.overflow = 'hidden';
        }
        
        // Manejadores para los botones del menú
        const menuButtons = document.querySelectorAll('.menu-button[data-action]');
        menuButtons.forEach(button => {
            button.addEventListener('click', function(this: HTMLButtonElement) {
                const action = this.getAttribute('data-action');
                
                // Navegar según la acción seleccionada
                if (action === 'inscripcion') {
                    swiper.slideTo(1); // ButtonsSlide con consulta de DNI
                } else if (action === 'legajo-digital') {
                    swiper.slideTo(2); // ButtonsSlide con consulta de DNI
                } else if (action === 'ingreso-art7') {
                    swiper.slideTo(3); // InfoSlide
                }
            });
        });

        // Escuchar el evento personalizado para la navegación entre slides
        document.addEventListener('navigateToSlide', (e: any) => {
            if (e.detail && typeof e.detail.slideIndex === 'number') {
                swiper.slideTo(e.detail.slideIndex);
            }
        });
    });
</script>

<style>
    /* Estilos adicionales para la navegación del Swiper */
    .swiper-button-next,
    .swiper-button-prev {
        color: #fff;
        background-color: rgba(0, 0, 0, 0.3);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    /* Clase para ocultar los botones de navegación */
    .hidden-nav {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }
    
    .swiper-button-next:after,
    .swiper-button-prev:after {
        font-size: 18px;
    }
    
    .swiper-button-next {
        right: 20px;
    }
    
    .swiper-button-prev {
        left: 20px;
    }
    
    /* Posicionamiento de la paginación */
    .swiper-pagination {
        bottom: 30px !important;
    }
    
    /* Hacer responsive la navegación */
    @media (max-width: 768px) {
        .swiper-button-next,
        .swiper-button-prev {
            width: 35px;
            height: 35px;
        }
        
        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 16px;
        }
        
        .swiper-button-next {
            right: 10px;
        }
        
        .swiper-button-prev {
            left: 10px;
        }
        
        .swiper-pagination {
            bottom: 15px !important;
        }
    }
    
    /* Estilos adicionales para dispositivos muy pequeños */
    @media (max-width: 480px) {
        .swiper-button-next,
        .swiper-button-prev {
            width: 30px;
            height: 30px;
            transform: translateY(-50%);
        }
        
        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 14px;
        }
        
        .swiper-pagination {
            bottom: 10px !important;
        }
    }
    
    /* Mejora para el contenedor de Swiper en dispositivos móviles */
    @media (max-width: 640px) {
        .swiper-container {
            height: auto;
            min-height: 100vh;
        }
        
        .swiper-slide {
            height: auto;
            min-height: 100vh;
        }
    }
</style>
